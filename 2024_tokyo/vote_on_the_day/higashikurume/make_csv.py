#
# cd 2024_tokyo/vote_on_the_day/higashikurume
# python make_csv.py
#
import re


########################################
# è¨­å®š
########################################

input_file_name = 'input_data.txt'
output_file_name = 'output_data.csv'


########################################
# æº–å‚™
########################################

# é™¤å¤–è¡Œã®ãƒªã‚¹ãƒˆï¼ˆãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ï¼‰
except_lines_as_text = """\
ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ã€ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³éƒ¨åˆ†ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—æœ¬æ–‡ã¸ç§»å‹•ã—ã¾ã™ã€‚
æ±ä¹…ç•™ç±³å¸‚

æ–‡å­—ã‚µã‚¤ã‚ºã®å¤‰æ›´ ç¸®å° æ¨™æº– æ‹¡å¤§ é…è‰²ã®å¤‰æ›´ èƒŒæ™¯è‰²ã‚’å…ƒã«æˆ»ã™ èƒŒæ™¯è‰²ã‚’é’è‰²ã«ã™ã‚‹ èƒŒæ™¯è‰²ã‚’é»’è‰²ã«ã™ã‚‹ èƒŒæ™¯è‰²ã‚’é»„è‰²ã«ã™ã‚‹
éŸ³å£°èª­ã¿ä¸Šã’ Englishãƒ»ç°¡ä½“ä¸­æ–‡ãƒ»ç¹é«”ä¸­æ–‡ãƒ»í•œêµ­ì–´ãƒ»ãŒã„ã“ãã®ã‹ãŸã¸
ã‚µã‚¤ãƒˆå†…æ¤œç´¢ 
æš®ã‚‰ã—ã®æƒ…å ±æ–½è¨­æ¡ˆå†…å¸‚æ”¿æƒ…å ±æ–‡åŒ–ãƒ»ã‚¹ãƒãƒ¼ãƒ„ã‚¤ãƒ™ãƒ³ãƒˆ
ç¾åœ¨ä½ç½®ï¼š  ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ > å¸‚æ”¿ã‚’èº«è¿‘ã« > é¸æŒ™ç®¡ç†å§”å“¡ä¼š > æŠ•ç¥¨åŒºåŸŸã¨æŠ•ç¥¨æ‰€ä¸€è¦§è¡¨

ã“ã“ã‹ã‚‰æœ¬æ–‡ã§ã™ã€‚
æŠ•ç¥¨åŒºåŸŸã¨æŠ•ç¥¨æ‰€ä¸€è¦§è¡¨
ãƒšãƒ¼ã‚¸ç•ªå·ã€€1022305ã€€æ›´æ–°æ—¥ã€€ ä»¤å’Œ4å¹´6æœˆ20æ—¥
æŠ•ç¥¨åŒºåŸŸã¨æŠ•ç¥¨æ‰€ä¸€è¦§è¡¨ï¼ˆç”ºåäº”åéŸ³é †ï¼‰
ç”ºå	åŒºåŸŸ	æŠ•ç¥¨åŒº	æŠ•ç¥¨æ‰€




ã“ã®ãƒšãƒ¼ã‚¸ã«é–¢ã™ã‚‹ãŠå•ã„åˆã‚ã›
æ±ä¹…ç•™ç±³å¸‚å½¹æ‰€
ã€’203-8555 æ±äº¬éƒ½æ±ä¹…ç•™ç±³å¸‚æœ¬ç”º3-3-1
é›»è©±ï¼š042-470-7777
ãŠå•ã„åˆã‚ã›ã¯å°‚ç”¨ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚

å¸‚æ”¿ã‚’èº«è¿‘ã«
é¸æŒ™ç®¡ç†å§”å“¡ä¼š
æŠ•ç¥¨åŒºåŸŸã¨æŠ•ç¥¨æ‰€ä¸€è¦§è¡¨
æŠ•ç¥¨æ”¯æ´ã‚«ãƒ¼ãƒ‰ã®ã”æ¡ˆå†…
æ±äº¬éƒ½çŸ¥äº‹é¸æŒ™ã®æŠ•ç¥¨æ—¥ã¯7æœˆ7æ—¥(æ—¥æ›œæ—¥)åˆå‰7æ™‚ã‹ã‚‰åˆå¾Œ8æ™‚ã§ã™
é¸æŒ™ç®¡ç†å“¡ä¼šå§”å“¡ã®æ§‹æˆåŠã³ä»»æœŸ
ã“ã‚Œã‹ã‚‰ã®é¸æŒ™
ã“ã‚Œã¾ã§ã®é¸æŒ™
é¸æŒ™ã®ä»•çµ„ã¿
æ˜ã‚‹ã„é¸æŒ™
æ¤œå¯Ÿå¯©æŸ»ä¼š
ãƒã‚¤ãƒšãƒ¼ã‚¸
å‰ã®ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹ ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹ è¡¨ç¤º PC ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³
ã‚µã‚¤ãƒˆãƒãƒƒãƒ— ã“ã®ã‚µã‚¤ãƒˆã®ä½¿ã„æ–¹ å…è²¬äº‹é …ãƒ»ãƒªãƒ³ã‚¯ã«ã¤ã„ã¦ è‘—ä½œæ¨©ã«ã¤ã„ã¦ ãŠå•ã„åˆã‚ã› æºå¸¯ã‚µã‚¤ãƒˆ
æ±ä¹…ç•™ç±³å¸‚å½¹æ‰€
ã€’203ï¼8555ã€€æ±äº¬éƒ½æ±ä¹…ç•™ç±³å¸‚æœ¬ç”º3-3-1 æ±ä¹…ç•™ç±³å¸‚å½¹æ‰€ã®åœ°å›³ äº¤é€šæ¡ˆå†…
é›»è©±ï¼š042-470-7777
æ³•äººç•ªå·ï¼š3000020132225

Copyright Â© Higashikurume city. All rights reserved.

èª­ã¿ä¸Šã’ã‚‹
"""

# é™¤å¤–è¡Œã®ãƒªã‚¹ãƒˆ
except_lines = []

for line in except_lines_as_text.split("\n"):
    line = line.strip()
    # ç©ºè¡Œã¯é™¤å¤–
    if line != '':
        except_lines.append(line)


def is_ignore_line(line):
    """ã“ã®è¡Œã‚’ç„¡è¦–ã™ã‚‹ã‹ï¼Ÿ"""

    # ç©ºè¡Œ
    if line == '':
        return True

    return line in except_lines


def double_quote(text):
    """ã‚«ãƒ³ãƒãŒå«ã¾ã‚Œã¦ã„ã‚Œã°ã€äºŒé‡å¼•ç”¨ç¬¦ã§å›²ã‚€"""
    if ',' in text:
        return f'"{text}"'

    return text


########################################
# ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œæ™‚
########################################

if __name__ == '__main__':
    """ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œæ™‚"""

    # ãƒ•ã‚¡ã‚¤ãƒ«èª­å–
    print(f'read `{input_file_name}` file...')

    with open(input_file_name, 'r', encoding='utf-8') as f:
        lines = f.readlines()


    # è¦‹å‡ºã—
    ward_number = None
    building_name = None
    address = None

    output_table = []

    # å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    output_table.append(f'''æŠ•ç¥¨åŒºç•ªå·, ä½æ‰€, æ–½è¨­å''')

    # æŠ•ç¥¨æ‰€ã®åå‰ã®é›†åˆ
    voting_station_data_set = set()

    for line in lines:

        # å‰å¾Œã®ç©ºç™½ã€æ”¹è¡Œã‚’é™¤å»
        line = line.strip()

        # é™¤å¤–è¡Œ
        if is_ignore_line(line):
            continue

        #print(f"[raw line] {line}")

        # ã¨ã‚Šã‚ãˆãšï¼‘è¡Œã‚’ã‚¿ãƒ–ã§ã‚¹ãƒ—ãƒªãƒƒãƒˆ
        tokens = line.split('\t')
        #print(f'len(tokens):{len(tokens)}')

        # ğŸ‘‡ ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã£ãŸå ´åˆã€
        #
        #   ä¾‹ï¼š `ä¸Šã®åŸ	ä¸€ä¸ç›®ãƒ»äºŒä¸ç›®	20	ã‚°ãƒªãƒ¼ãƒ³ãƒ’ãƒ«ã‚º2å·æ£Ÿé›†ä¼šæ‰€`
        #
        # ï¼»ä¸Šã®åŸï¼½ã‚‚ã€ï¼»ä¸€ä¸ç›®ãƒ»äºŒä¸ç›®ï¼½ã‚‚ã€ï¼»ã‚°ãƒªãƒ¼ãƒ³ãƒ’ãƒ«ã‚º2å·æ£Ÿé›†ä¼šæ‰€ï¼½ã®ä½æ‰€ã§ã¯ãªãã€
        # ï¼»ä¸Šã®åŸä¸€ä¸ç›®ãƒ»äºŒä¸ç›®ï¼½ã®äººã¯ï¼»ã‚°ãƒªãƒ¼ãƒ³ãƒ’ãƒ«ã‚º2å·æ£Ÿé›†ä¼šæ‰€ï¼½ã¸è¡Œã‘ã€ã¨ã„ã†æŒ‡ç¤ºã§ã‚ã£ã¦ã€
        # ã“ã®è¡¨ã®ä¸­ã«ã¯ï¼»ã‚°ãƒªãƒ¼ãƒ³ãƒ’ãƒ«ã‚º2å·æ£Ÿé›†ä¼šæ‰€ï¼½ã®ä½æ‰€ã¯æ›¸ã‹ã‚Œã¦ã„ãªã„ã€‚
        #
        # ãã“ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã«ã§ãã‚‹ã“ã¨ã¯ï¼»æ±äº¬éƒ½ä¹…ç•™ç±³å¸‚ ã‚°ãƒªãƒ¼ãƒ³ãƒ’ãƒ«ã‚º2å·æ£Ÿé›†ä¼šæ‰€ï¼½ã¨ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä½œã£ã¦
        # ã‚°ãƒ¼ã‚°ãƒ«ãƒãƒƒãƒ—ã«æŠ•ã’ã‚‹ã“ã¨ã ã€‚
        #
        # ğŸ‘‡ ã¾ãŸã€
        #
        #   ä¾‹ï¼š `æ±äº¬éƒ½æ±ä¹…ç•™ç±³å¸‚ä¸Šã®åŸ ã‚°ãƒªãƒ¼ãƒ³ãƒ’ãƒ«ã‚º2å·æ£Ÿé›†ä¼šæ‰€`
        #   ä¾‹ï¼š `æ±äº¬éƒ½æ±ä¹…ç•™ç±³å¸‚ç¥å®ç”º ã‚°ãƒªãƒ¼ãƒ³ãƒ’ãƒ«ã‚º2å·æ£Ÿé›†ä¼šæ‰€`
        #
        # ç¥¨ã®ä¸­ã«ï¼»ã‚°ãƒªãƒ¼ãƒ³ãƒ’ãƒ«ã‚º2å·æ£Ÿé›†ä¼šæ‰€ï¼½ãŒï¼’å›å‡ºã¦ãã‚‹ã¨ã„ã£ãŸã“ã¨ã‚‚ã‚ã‚‹
        #

        ward_num = None

        for token in tokens:
            # åŠè§’æ•°å­—ã ã‘ã®ã‚»ãƒ«ãŒå‡ºã¦ãã‚‹ã¾ã§ã¯ã€ï¼»ç”ºåï¼½ã‹ã€ï¼»åŒºåŸŸï¼½ã€‚ãã®ã©ã¡ã‚‰ã‚‚ç„¡è¦–ã™ã‚‹
            if ward_num is None:
                m = re.match(r'(\d+)', token)
                if m:
                    ward_num = int(m.group(1))

            # åŠè§’æ•°å­—ãŒå‡ºã¦ãã¦ä»¥é™ã¯æ–½è¨­å
            # ã‚»ãƒ«çµåˆã§æ–½è¨­åãŒç„¡ã„ã“ã¨ã‚‚ã‚ã‚‹ã€‚ãã®å ´åˆã¯ç„¡è¦–
            else:
                voting_station_data_set.add((ward_num, token))

    # æŠ•ç¥¨åŒºç•ªå·é †ã«ã‚½ãƒ¼ãƒˆ
    sorted_voting_station_data_list = sorted(
            list(voting_station_data_set),
            key=lambda tuple: tuple[0])

    for voting_station_data in sorted_voting_station_data_list:
        ward_num = voting_station_data[0]
        voting_station_name = voting_station_data[1]

        # å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        address_cell = double_quote(f"æ±äº¬éƒ½æ±ä¹…ç•™ç±³å¸‚ {voting_station_name}")
        building_cell = double_quote(voting_station_name)
        output_line = f'{ward_num}, {address_cell}, {building_cell}'
        #print(f'[output] {output_line}')
        output_table.append(output_line)


    # ãƒ•ã‚¡ã‚¤ãƒ«æ›¸å‡ºã—
    with open(output_file_name, 'w', encoding='utf-8') as f:
        for line in output_table:
            #print(line)
            f.write(f'{line}\n')

    print(f"please read `{output_file_name}` file")
